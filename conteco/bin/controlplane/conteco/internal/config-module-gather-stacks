#!/usr/bin/env bash
deployPath=$1

(
DOLLAR="$"
environment_template=$'#!/usr/bin/env bash\n\n'
IFS=',' read -r -a stacks <<< "${CONTECO_DC_GLOBAL_STACKS}"
for stack in ${stacks[@]};
do
	stackPath="${CONTECO_PWD}/${CONTECO_REALM}/${CONTECO_ECOSYSTEM}.$stack/conteco/assets/$(echo "$stack" | tr . /)/deploy"
	cp $stackPath/docker-compose.yml $deployPath/$stack.docker-compose.yml
	stackEnvironment=$(sed -n "/# START VARIABLES/,/# END VARIABLES/p" $stackPath/environment)
	environment_template="${environment_template}${stackEnvironment}
"
	done;
environment_template="${environment_template}# START GLOBAL VARIABLES
export CONTECO_GLOBAL_NETWORKS=
export CONTECO_GLOBAL_VOLUMES=
# END GLOBAL VARIABLES
"
echo "$environment_template" > $deployPath/environment.template
)
