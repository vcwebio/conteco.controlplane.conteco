#!/usr/bin/env bash
stackName=$1
composefile=$2

export CONTECO_STACKPREFIX="conteco"
export CONTECO_NETWORKLOCAL="conteco"
export CONTECO_NETWORKGLOBAL="conteco"

tmpfile=$(mktemp /tmp/docker-compose.yml.XXXXXX)
arguments="-c $tmpfile $stackName"
(
	cat $composefile | envsubst > $tmpfile
	cat $tmpfile
)
executionplane docker stack deploy $arguments
rm $tmpfile
